<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace ="loginMapper">
<select id="login" resultType="userDto">
SELECT *
  FROM USERTABLE u
LEFT JOIN USERDETAIL d
    ON u.EMAIL = d.ID 
 WHERE u.EMAIL = #{email}
   AND u.PASSWORD = #{password}
   AND d.DELETED = 'N'
</select>
<select id="login2" resultType="userDto">
SELECT *
  FROM USERTABLE u
LEFT JOIN USERDETAIL d
    ON u.EMAIL = d.ID
 WHERE u.EMAIL = #{email}
   AND u.PASSWORD = #{password}
</select>
<select id="searchUserEmail" resultType="userDto">
SELECT *
  FROM USERTABLE u
LEFT JOIN USERDETAIL d
    ON u.EMAIL = d.ID
 WHERE u.EMAIL = #{email}
</select>
<select id="getAdminLogin" resultType="userDto">
SELECT *
  FROM USERTABLE u
LEFT JOIN ADMIN d
    ON u.EMAIL = d.ID
 WHERE u.EMAIL = #{email}
   AND u.PASSWORD = #{password}
</select>

<select id="searchId" resultType="userDto">
SELECT EMAIL
  FROM USERTABLE
 WHERE email = #{id}
</select>
<select id="findId" resultType="String">
SELECT EMAIL
  FROM USERTABLE
 WHERE NAME = #{name}
   AND PHONE = #{phone}
   AND BIRTH = #{birth}
</select>

<select id="idChk" resultType="int">
SELECT count(*) 
  FROM USERTABLE
 WHERE EMAIL = #{email}
</select>

<select id="userCheck" resultType="UserDTO">
SELECT EMAIL 
  FROM USERTABLE
 WHERE PHONE = #{phone}
   AND BIRTH = #{birth}
   AND NAME = #{name}
</select>
<select id="userJCheck" resultType="int">
SELECT count(*) 
  FROM USERTABLE
 WHERE PHONE = #{phone}
   AND EMAIL = #{email}
   AND NAME = #{name}
</select>

<insert id="signup"  parameterType="UserDTO">
INSERT INTO USERTABLE
(NAME,PASSWORD,PHONE,BIRTH,GENDER,EMAIL,NICKNAME)
VALUES
(#{name},#{password},#{phone},#{birth},#{gender},#{email},#{nickName})
</insert>

<insert id="kakaoSignup"  parameterType="UserDTO">
INSERT INTO USERTABLE
(NAME,PASSWORD,PHONE,EMAIL,NICKNAME,BIRTH)
VALUES
(#{name},#{password},kakaoNum.NEXTVAL,#{email},#{nickName},SYSDATE)
</insert>


<insert id="signupDetail"  parameterType="UserDTO">
INSERT INTO USERDETAIL
(ID)
VALUES
(#{email})
</insert>
<insert id="kakaoSignupDetail"  parameterType="UserDTO">
INSERT INTO USERDETAIL
(ID,KAKAOAUTH)
VALUES
(#{email},'Y')
</insert>


<insert id="emailRes"  parameterType="UserDTO">
INSERT INTO USERTABLE
(email)
VALUES
(#{email})
</insert>


<update id="loginLog">
UPDATE USERDETAIL
   SET DATELOG = SYSDATE
 WHERE id=#{email}
</update>


<select id="nickNameCheck" resultType="int">
SELECT count(*) 
  FROM USERTABLE
 WHERE NICKNAME = #{nickName}
</select>

<update id="setNickName">
UPDATE USERTABLE
   SET NICKNAME = #{nickName}
 WHERE email=#{email}
</update>

<delete id="dropId">
DELETE USERTABLE
WHERE EMAIL =#{email}
</delete>


<select id="nickChk" resultType="int">
SELECT count(*)
  FROM USERTABLE
 WHERE NICKNAME = #{nickName}
   AND EMAIL = #{email}
</select>



<insert id="imageToDB">

</insert>
<update id="imageToProfile">

</update>
<select id="kakaoLogin" resultType="userDto">
SELECT *
  FROM USERTABLE u
 LEFT JOIN USERDETAIL d
    ON u.EMAIL = d.ID
 WHERE u.EMAIL = #{email}
   AND d.DELETED = 'N'
</select>


<update id="resetPassword">
UPDATE USERDETAIL
   SET TEMPPASS = 'Y'
 WHERE id=#{email}
</update>

<update id="resetPassword2">
UPDATE USERTABLE
   SET PASSWORD=#{password}
 WHERE EMAIl=#{email}
</update>
<select id="passCheck" resultType="int">
SELECT count(*)
  FROM USERTABLE u
LEFT JOIN USERDETAIL d
    ON u.EMAIL = d.ID
 WHERE u.EMAIL = #{email}
   AND u.PASSWORD = #{password}
   AND d.DELETED = 'N'
</select>

<update id="setPassword">
UPDATE USERTABLE
   SET PASSWORD=#{password}
 WHERE EMAIL=#{email}
 AND NAME =#{name}
</update>

<update id="setPassword2">
UPDATE USERDETAIL
   SET TEMPPASS='N'
 WHERE ID=#{email}
</update>
</mapper>
